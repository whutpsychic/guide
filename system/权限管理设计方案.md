# 权限管理设计方案
[1  简介](#user-content-1--简介)

[2  登录时权限获取](#user-content-2--登录时权限获取)

[3  菜单配置页面接口设计](#user-content-3--菜单配置页面接口设计)

　　[3.1  查询所有菜单](#user-content-31--查询所有菜单)

　　[3.2  新增菜单](#user-content-32--新增菜单)

　　[3.3  编辑菜单](#user-content-33--编辑菜单)

　　[3.4  删除菜单](#user-content-34--删除菜单)

　　[3.5  上移](#user-content-35--上移)

　　[3.6  下移](#user-content-36--下移)

[4  功能授权页面接口设计](#user-content-4--功能授权页面接口设计)

　　[4.1  获取所有的菜单和功能信息](#user-content-41--获取所有的菜单和功能信息)

　　[4.2  获取角色功能权限](#user-content-42--获取角色功能权限)

　　[4.3  修改角色功能权限](#user-content-43--修改角色功能权限)

##  1  简介

本文介绍了系统权限的实现思路，以及与权限有关的接口设计。

权限的基本设定如下：

```
用户属于角色，角色拥有功能。
```

每个用户属于一个或多个角色，每个角色拥有若干个功能的使用权。

用户登录时，后台返回用户拥有的权限信息，根据权限信息来动态加载页面内容。

功能权限是按照页面维护的，每个页面包含若干功能点。不同角色在同一个页面内，具有的权限有可能不一样。



##  2  登录时权限获取

用户登录成功后，后台根据用户的角色，得知用户所拥有的权限。后台将权限信息返回给前台页面，在页面中仅显示用户有权访问的页面或功能。

本小节描述用户权限信息的数据结构。

权限信息的格式是一个对象数组，数组每一项字段如下：

| 字段       | 类型     | 说明                                   |
| -------- | ------ | ------------------------------------ |
| menuId   | int    | 菜单主键编码                               |
| parentId | int    | 指向父菜单的主键Id                           |
| name     | string | 菜单的名字，用于界面显示                         |
| folder   | string | 源代码位置                                |
| feature  | string | 用户在页面中拥有的功能，使用逗号分隔多个功能点。例如`add,edit` |

如上表所示，用户权限信息通过一个数组描述，在数组中的每一项表示一个菜单项。

前台获取菜单数组后，在主页面中仅显示这一部分菜单，因此用户只可以看到自己有权访问的页面。

这里要注意的是`feature`字段。一个菜单项的`feature`字段，描述的是用户在此菜单中所享有的具体权限。如果用户在某菜单内有多个权限，则通过逗号进行连接。举例来说，假设某菜单项的`feature`字段取值为`add,edit`，则说明用户在此菜单页面中拥有`add`和`edit`的权限。

此外，后台返回的菜单应是按正确顺序排列的。



##  3  菜单配置页面接口设计

本小节描述菜单配置页面的接口设计。

在菜单配置页面中，可以新增、编辑、删除系统菜单，同时可以配置每个页面所具有的功能点。



###  3.1  查询所有菜单

进入菜单配置页面后，显示所有菜单的信息。返回信息如下：

| 字段          | 类型     | 说明                                       |
| ----------- | ------ | ---------------------------------------- |
| menuId      | int    | 菜单Id                                     |
| parentId    | int    | 指向父菜单的主键Id                               |
| name        | string | 菜单名字                                     |
| folder      | string | 源代码位置                                    |
| fullfeature | string | 用户在页面中拥有的功能，使用逗号分隔多个功能点。且每个功能点包括缩写和名字两部分，以#分隔。例如`add#新增,edit#编辑` |

请注意`fullfeature`字段。`fullfeature`与之前出现过的`feature`是有区别的。在`fullfeature`中描述了功能点的英文名和中文名，在`feature`中仅包含英文名。



###  3.2  新增菜单

用户点击`新增`按钮，在指定菜单节点下创建子菜单。提交的信息如下：

| 字段          | 类型     | 说明                                       |
| ----------- | ------ | ---------------------------------------- |
| parentId    | int    | 指定将在哪个菜单下创建子菜单                           |
| name        | string | 菜单的名字                                    |
| folder      | string | 源代码位置                                    |
| fullfeature | string | 用户在页面中拥有的功能，使用逗号分隔多个功能点。且每个功能点包括缩写和名字两部分，以#分隔。例如`add#新增,edit#编辑` |



###  3.3  编辑菜单

用户选中某菜单，修改其信息后，点击`保存`按钮，对菜单信息进行编辑。提交的信息如下：

| 字段          | 类型     | 说明                                       |
| ----------- | ------ | ---------------------------------------- |
| menuId      | int    | 正在进行编辑的菜单                                |
| name        | string | 菜单的名字                                    |
| folder      | string | 源代码位置                                    |
| fullfeature | string | 用户在页面中拥有的功能，使用逗号分隔多个功能点。且每个功能点包括缩写和名字两部分，以#分隔。例如`add#新增,edit#编辑` |



###  3.4  删除菜单

用户选中某菜单，点击`删除`按钮，实现删除操作。提交的信息如下：

| 字段     | 类型   | 说明       |
| ------ | ---- | -------- |
| menuId | int  | 要删除的菜单Id |



###  3.5  上移

用户选中某菜单，点击`上移`按钮，将菜单顺序上移一个位置。提交的信息如下：

| 字段     | 类型   | 说明      |
| ------ | ---- | ------- |
| menuId | int  | 要上移菜单Id |



###  3.6  下移

用户选中某菜单，点击`下移`按钮，将菜单顺序下移一个位置。提交的信息如下：

| 字段     | 类型   | 说明      |
| ------ | ---- | ------- |
| menuId | int  | 要下移菜单Id |





##  4  功能授权页面接口设计

本小节描述功能授权页面的接口设计。

在功能授权页面中，可配置某角色的菜单访问权限和页面内功能权限。



###  4.1  获取所有的菜单和功能信息

打开功能授权页面时，首先需获取全部的菜单和功能信息。此接口与菜单配置页面的[查询所有菜单](#查询所有菜单)完全相同，不再重复。



###  4.2  获取角色功能权限

当用户希望配置某个角色的权限时，需首先获取该角色目前拥有的功能权限内容。

提交的信息如下：

| 字段     | 类型   | 说明   |
| ------ | ---- | ---- |
| roleId | int  | 角色Id |

返回该角色拥有的功能权限信息。

权限信息的格式是一个对象数组，数组每一项字段如下：

| 字段      | 类型     | 说明                                   |
| ------- | ------ | ------------------------------------ |
| menuId  | int    | 菜单Id                                 |
| feature | string | 用户在页面中拥有的功能，使用逗号分隔多个功能点。例如`add,edit` |



###  4.3  修改角色功能权限

用户可修改某个角色的权限，并提交修改后的该角色权限信息。提交的内容包含两部分。

第一部分是要修改的角色Id。

| 字段     | 类型   | 说明       |
| ------ | ---- | -------- |
| roleId | int  | 要修改的角色Id |

第二部分是修改后的该角色权限信息。权限信息的格式是一个对象数组，数组每一项字段如下：

| 字段      | 类型     | 说明                                   |
| ------- | ------ | ------------------------------------ |
| menuId  | int    | 菜单Id                                 |
| feature | string | 用户在页面中拥有的功能，使用逗号分隔多个功能点。例如`add,edit` |

